---
phase: 01-project-setup-ci-cd
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/build.gradle.kts
  - build.gradle.kts
  - settings.gradle.kts
  - gradle.properties
  - gradlew
  - gradlew.bat
  - gradle/wrapper/gradle-wrapper.jar
  - gradle/wrapper/gradle-wrapper.properties
  - gradle/libs.versions.toml
  - config/detekt/detekt.yml
  - app/src/main/AndroidManifest.xml
  - app/src/main/java/com/anshul/screenlight/MainActivity.kt
  - app/src/test/java/com/anshul/screenlight/ExampleUnitTest.kt
  - app/proguard-rules.pro
autonomous: true

must_haves:
  truths:
    - "./gradlew testDebugUnitTest runs and reports test results"
    - "./gradlew jacocoTestReport generates coverage XML"
    - "./gradlew detekt runs Kotlin static analysis"
    - "./gradlew assembleDebug produces an APK"
  artifacts:
    - path: "app/build.gradle.kts"
      provides: "Android app module with JaCoCo and Detekt plugins"
      contains: "jacoco"
    - path: "config/detekt/detekt.yml"
      provides: "Detekt configuration"
      contains: "maxIssues: 0"
    - path: "app/src/test/java/com/anshul/screenlight/ExampleUnitTest.kt"
      provides: "Sample unit test for coverage baseline"
      contains: "@Test"
  key_links:
    - from: "app/build.gradle.kts"
      to: "jacocoTestReport task"
      via: "task registration"
      pattern: "tasks.register.*JacocoReport"
    - from: "app/build.gradle.kts"
      to: "detekt configuration"
      via: "plugin configuration"
      pattern: "detekt\\s*\\{"
---

<objective>
Create a minimal Android project with Gradle, JaCoCo coverage, and Detekt linting configured.

Purpose: Establish the build foundation that CI/CD workflows will execute against. Without a working Gradle project with test infrastructure, the CI pipeline has nothing to run.

Output: A buildable Android project where `./gradlew testDebugUnitTest jacocoTestReport detekt assembleDebug` succeeds.
</objective>

<execution_context>
@/Users/anshul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/anshul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-setup-ci-cd/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Android project scaffold with Gradle wrapper</name>
  <files>
    build.gradle.kts
    settings.gradle.kts
    gradle.properties
    gradlew
    gradlew.bat
    gradle/wrapper/gradle-wrapper.jar
    gradle/wrapper/gradle-wrapper.properties
    gradle/libs.versions.toml
    app/build.gradle.kts
    app/src/main/AndroidManifest.xml
    app/src/main/java/com/anshul/screenlight/MainActivity.kt
    app/proguard-rules.pro
  </files>
  <action>
    Create a minimal Android project structure:

    1. **Root build.gradle.kts**: Apply Android and Kotlin plugins via alias (no versions, use catalog)
    2. **settings.gradle.kts**:
       - rootProject.name = "screenlight"
       - Include ":app" module
       - Configure pluginManagement with gradlePluginPortal() and google()
       - Configure dependencyResolutionManagement with google() and mavenCentral()
    3. **gradle.properties**:
       - org.gradle.jvm.args=-Xmx2048m -Dfile.encoding=UTF-8
       - android.useAndroidX=true
       - kotlin.code.style=official
    4. **gradle/libs.versions.toml**: Version catalog with:
       - [versions]: agp = "8.8.1", kotlin = "2.0.21", coreKtx = "1.15.0", junit = "4.13.2", junitVersion = "1.2.1", espressoCore = "3.6.1", lifecycleRuntimeKtx = "2.8.7", detekt = "1.23.8"
       - [libraries]: androidx-core-ktx, junit, androidx-junit, androidx-espresso-core, androidx-lifecycle-runtime-ktx
       - [plugins]: android-application, kotlin-android, detekt
    5. **gradlew and gradle wrapper**: Generate using `gradle wrapper --gradle-version 8.12.1` OR copy standard wrapper files. Ensure gradlew has execute permission.
    6. **app/build.gradle.kts**: See Task 2 for full content (this file configured in detail there)
    7. **app/src/main/AndroidManifest.xml**: Minimal manifest with package, application, and MainActivity
    8. **app/src/main/java/com/anshul/screenlight/MainActivity.kt**: Empty Compose activity (placeholder for Phase 2)
    9. **app/proguard-rules.pro**: Empty file (placeholder)

    Use package name: com.anshul.screenlight
    Use namespace: com.anshul.screenlight
    minSdk: 24, targetSdk: 35, compileSdk: 35
  </action>
  <verify>
    ls -la gradle/wrapper/gradle-wrapper.jar && ./gradlew --version
  </verify>
  <done>
    Gradle wrapper exists and reports version 8.12.1. Project structure matches standard Android layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure JaCoCo coverage and Detekt linting in app module</name>
  <files>
    app/build.gradle.kts
    config/detekt/detekt.yml
    app/src/test/java/com/anshul/screenlight/ExampleUnitTest.kt
  </files>
  <action>
    1. **app/build.gradle.kts** - Complete configuration from RESEARCH.md:
       ```kotlin
       plugins {
           alias(libs.plugins.android.application)
           alias(libs.plugins.kotlin.android)
           alias(libs.plugins.detekt)
           id("jacoco")
       }

       android {
           namespace = "com.anshul.screenlight"
           compileSdk = 35

           defaultConfig {
               applicationId = "com.anshul.screenlight"
               minSdk = 24
               targetSdk = 35
               versionCode = 1
               versionName = "1.0.0"
               testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
           }

           buildTypes {
               debug {
                   enableUnitTestCoverage = true
                   enableAndroidTestCoverage = true
               }
               release {
                   isMinifyEnabled = false
                   proguardFiles(getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro")
               }
           }

           compileOptions {
               sourceCompatibility = JavaVersion.VERSION_17
               targetCompatibility = JavaVersion.VERSION_17
           }

           kotlinOptions {
               jvmTarget = "17"
           }

           testOptions {
               unitTests {
                   isIncludeAndroidResources = true
                   all {
                       it.extensions.configure<JacocoTaskExtension> {
                           isIncludeNoLocationClasses = true
                           excludes = listOf("jdk.internal.*")
                       }
                   }
               }
           }
       }

       detekt {
           buildUponDefaultConfig = true
           allRules = false
           config.setFrom(files("$rootDir/config/detekt/detekt.yml"))
       }

       tasks.withType<io.gitlab.arturbosch.detekt.Detekt>().configureEach {
           reports {
               html.required.set(true)
               sarif.required.set(true)
               xml.required.set(false)
           }
           jvmTarget = "17"
       }

       tasks.register<JacocoReport>("jacocoTestReport") {
           dependsOn("testDebugUnitTest")
           reports {
               xml.required.set(true)
               html.required.set(true)
           }
           sourceDirectories.setFrom(files("src/main/java", "src/main/kotlin"))
           classDirectories.setFrom(files(
               fileTree("build/intermediates/javac/debug") {
                   exclude("**/R.class", "**/R$*.class", "**/BuildConfig.*", "**/Manifest*.*")
               },
               fileTree("build/tmp/kotlin-classes/debug") {
                   exclude("**/R.class", "**/R$*.class", "**/BuildConfig.*", "**/Manifest*.*")
               }
           ))
           executionData.setFrom(fileTree(layout.buildDirectory) {
               include("jacoco/testDebugUnitTest.exec")
           })
       }

       dependencies {
           implementation(libs.androidx.core.ktx)
           implementation(libs.androidx.lifecycle.runtime.ktx)
           testImplementation(libs.junit)
           androidTestImplementation(libs.androidx.junit)
           androidTestImplementation(libs.androidx.espresso.core)
       }
       ```

    2. **config/detekt/detekt.yml** - Minimal override config:
       ```yaml
       build:
         maxIssues: 0

       style:
         MaxLineLength:
           maxLineLength: 120
       ```

    3. **app/src/test/java/com/anshul/screenlight/ExampleUnitTest.kt** - Sample test:
       ```kotlin
       package com.anshul.screenlight

       import org.junit.Test
       import org.junit.Assert.*

       class ExampleUnitTest {
           @Test
           fun addition_isCorrect() {
               assertEquals(4, 2 + 2)
           }
       }
       ```

    IMPORTANT: Use `layout.buildDirectory` (not deprecated `buildDir`) for JaCoCo executionData path.
  </action>
  <verify>
    ./gradlew testDebugUnitTest jacocoTestReport detekt && ls app/build/reports/jacoco/jacocoTestReport/jacocoTestReport.xml && ls app/build/reports/detekt/detekt.html
  </verify>
  <done>
    Tests pass, JaCoCo XML report exists at app/build/reports/jacoco/jacocoTestReport/jacocoTestReport.xml, Detekt HTML report exists.
  </done>
</task>

</tasks>

<verification>
1. `./gradlew testDebugUnitTest` - Unit tests pass
2. `./gradlew jacocoTestReport` - Coverage report generated
3. `./gradlew detekt` - Lint passes with no issues
4. `./gradlew assembleDebug` - APK builds successfully
5. `ls app/build/outputs/apk/debug/*.apk` - Debug APK exists
</verification>

<success_criteria>
- All four Gradle tasks succeed: testDebugUnitTest, jacocoTestReport, detekt, assembleDebug
- Coverage XML report exists and contains data
- Detekt report shows 0 issues (maxIssues: 0 enforced)
- Debug APK is produced at app/build/outputs/apk/debug/
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup-ci-cd/01-01-SUMMARY.md`
</output>
