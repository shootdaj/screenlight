---
phase: 02-core-services-screen-light
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gradle/libs.versions.toml
  - app/build.gradle.kts
  - app/src/main/java/com/anshul/screenlight/ScreenlightApplication.kt
  - app/src/main/java/com/anshul/screenlight/di/AppModule.kt
  - app/src/main/AndroidManifest.xml
autonomous: true

must_haves:
  truths:
    - "Compose UI renders in MainActivity"
    - "Hilt injects dependencies into Application"
    - "DataStore is available as singleton"
  artifacts:
    - path: "app/src/main/java/com/anshul/screenlight/ScreenlightApplication.kt"
      provides: "Hilt Application class"
      contains: "@HiltAndroidApp"
    - path: "app/src/main/java/com/anshul/screenlight/di/AppModule.kt"
      provides: "Hilt DI module with DataStore provider"
      contains: "@Provides"
    - path: "gradle/libs.versions.toml"
      provides: "Compose, Hilt, DataStore versions"
      contains: "composeBom"
  key_links:
    - from: "AndroidManifest.xml"
      to: "ScreenlightApplication"
      via: "android:name attribute"
      pattern: 'android:name=".ScreenlightApplication"'
    - from: "AppModule.kt"
      to: "DataStore"
      via: "preferencesDataStore extension"
      pattern: "preferencesDataStore"
---

<objective>
Add Jetpack Compose, Hilt, and DataStore dependencies with DI foundation

Purpose: Establish the core dependency injection and UI framework required by all subsequent Phase 2 work
Output: Configured build with Compose rendering, Hilt injection working, DataStore singleton available
</objective>

<execution_context>
@/Users/anshul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/anshul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-services-screen-light/02-RESEARCH.md
@gradle/libs.versions.toml
@app/build.gradle.kts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Compose, Hilt, and DataStore dependencies to version catalog</name>
  <files>gradle/libs.versions.toml, app/build.gradle.kts, build.gradle.kts</files>
  <action>
Update gradle/libs.versions.toml with:
```toml
[versions]
# Add these new versions
composeBom = "2026.01.00"
hilt = "2.57.1"
hiltNavigationCompose = "1.3.0"
datastore = "1.2.0"
coroutines = "1.7.3"
activityCompose = "1.13.0"
lifecycleViewModelCompose = "2.8.7"
ksp = "2.0.21-1.0.31"  # Must match Kotlin version

[libraries]
# Add these new libraries
androidx-compose-bom = { group = "androidx.compose", name = "compose-bom", version.ref = "composeBom" }
androidx-compose-ui = { group = "androidx.compose.ui", name = "ui" }
androidx-compose-material3 = { group = "androidx.compose.material3", name = "material3" }
androidx-compose-foundation = { group = "androidx.compose.foundation", name = "foundation" }
androidx-compose-ui-tooling = { group = "androidx.compose.ui", name = "ui-tooling" }
androidx-compose-ui-tooling-preview = { group = "androidx.compose.ui", name = "ui-tooling-preview" }
androidx-activity-compose = { group = "androidx.activity", name = "activity-compose", version.ref = "activityCompose" }
androidx-lifecycle-viewmodel-compose = { group = "androidx.lifecycle", name = "lifecycle-viewmodel-compose", version.ref = "lifecycleViewModelCompose" }
hilt-android = { group = "com.google.dagger", name = "hilt-android", version.ref = "hilt" }
hilt-compiler = { group = "com.google.dagger", name = "hilt-compiler", version.ref = "hilt" }
hilt-navigation-compose = { group = "androidx.hilt", name = "hilt-navigation-compose", version.ref = "hiltNavigationCompose" }
datastore-preferences = { group = "androidx.datastore", name = "datastore-preferences", version.ref = "datastore" }
kotlinx-coroutines-android = { group = "org.jetbrains.kotlinx", name = "kotlinx-coroutines-android", version.ref = "coroutines" }

[plugins]
# Add these new plugins
hilt = { id = "com.google.dagger.hilt.android", version.ref = "hilt" }
ksp = { id = "com.google.devtools.ksp", version.ref = "ksp" }
compose-compiler = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }
```

Update build.gradle.kts (root) to add plugin aliases:
```kotlin
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.kotlin.android) apply false
    alias(libs.plugins.hilt) apply false
    alias(libs.plugins.ksp) apply false
    alias(libs.plugins.compose.compiler) apply false
}
```

Update app/build.gradle.kts to apply plugins and add dependencies:
```kotlin
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.detekt)
    alias(libs.plugins.hilt)
    alias(libs.plugins.ksp)
    alias(libs.plugins.compose.compiler)
    id("jacoco")
}

android {
    // Existing config...

    buildFeatures {
        compose = true
    }
}

dependencies {
    // Compose BOM
    val composeBom = platform(libs.androidx.compose.bom)
    implementation(composeBom)
    androidTestImplementation(composeBom)

    // Compose
    implementation(libs.androidx.compose.ui)
    implementation(libs.androidx.compose.material3)
    implementation(libs.androidx.compose.foundation)
    implementation(libs.androidx.compose.ui.tooling.preview)
    debugImplementation(libs.androidx.compose.ui.tooling)

    // Activity Compose (replaces activity-ktx)
    implementation(libs.androidx.activity.compose)

    // Lifecycle ViewModel Compose
    implementation(libs.androidx.lifecycle.viewmodel.compose)

    // Hilt
    implementation(libs.hilt.android)
    ksp(libs.hilt.compiler)
    implementation(libs.hilt.navigation.compose)

    // DataStore
    implementation(libs.datastore.preferences)

    // Coroutines
    implementation(libs.kotlinx.coroutines.android)

    // Keep existing dependencies...
}
```

IMPORTANT: Remove activity-ktx dependency (replaced by activity-compose). Keep core-ktx, lifecycle-runtime-ktx, and test dependencies.
  </action>
  <verify>Run `./gradlew app:dependencies --configuration debugCompileClasspath | grep -E "(compose|hilt|datastore)"` to confirm dependencies resolve. Run `./gradlew assembleDebug` to verify build succeeds.</verify>
  <done>Compose BOM, Hilt, and DataStore dependencies compile without errors. Activity-compose replaces activity-ktx.</done>
</task>

<task type="auto">
  <name>Task 2: Create Hilt Application and DI module with DataStore</name>
  <files>app/src/main/java/com/anshul/screenlight/ScreenlightApplication.kt, app/src/main/java/com/anshul/screenlight/di/AppModule.kt, app/src/main/AndroidManifest.xml</files>
  <action>
Create ScreenlightApplication.kt:
```kotlin
package com.anshul.screenlight

import android.app.Application
import dagger.hilt.android.HiltAndroidApp

@HiltAndroidApp
class ScreenlightApplication : Application()
```

Create di/AppModule.kt:
```kotlin
package com.anshul.screenlight.di

import android.content.Context
import androidx.datastore.core.DataStore
import androidx.datastore.preferences.core.Preferences
import androidx.datastore.preferences.preferencesDataStore
import dagger.Module
import dagger.Provides
import dagger.hilt.InstallIn
import dagger.hilt.android.qualifiers.ApplicationContext
import dagger.hilt.components.SingletonComponent
import javax.inject.Singleton

private val Context.dataStore: DataStore<Preferences> by preferencesDataStore(name = "screen_settings")

@Module
@InstallIn(SingletonComponent::class)
object AppModule {

    @Provides
    @Singleton
    fun provideDataStore(@ApplicationContext context: Context): DataStore<Preferences> {
        return context.dataStore
    }
}
```

Update AndroidManifest.xml to reference Application class:
```xml
<application
    android:name=".ScreenlightApplication"
    android:allowBackup="true"
    ...
```

Update MainActivity.kt to use Compose and Hilt:
```kotlin
package com.anshul.screenlight

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import dagger.hilt.android.AndroidEntryPoint

@AndroidEntryPoint
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            MaterialTheme {
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    Box(
                        modifier = Modifier.fillMaxSize(),
                        contentAlignment = Alignment.Center
                    ) {
                        Text("Screenlight")
                    }
                }
            }
        }
    }
}
```
  </action>
  <verify>Run `./gradlew assembleDebug` to verify Hilt annotation processing works. Run `./gradlew testDebugUnitTest` to ensure tests still pass.</verify>
  <done>App builds with Hilt, MainActivity displays Compose UI with "Screenlight" text centered.</done>
</task>

</tasks>

<verification>
1. `./gradlew assembleDebug` builds successfully
2. `./gradlew testDebugUnitTest` passes
3. `./gradlew detekt` has no violations
4. App launches and shows "Screenlight" text (manual verification or Robolectric test)
</verification>

<success_criteria>
- Compose UI framework renders in MainActivity
- Hilt DI container initializes on app start
- DataStore singleton is injectable via Hilt
- All tests pass, coverage threshold met
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-services-screen-light/02-01-SUMMARY.md`
</output>
